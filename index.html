<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenClaw Mission Control</title>
    <meta name="color-scheme" content="dark light" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <style>
      #debug-overlay {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        max-height: 200px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.9);
        color: #0f0;
        font-family: monospace;
        font-size: 11px;
        padding: 10px;
        z-index: 999999;
        border-top: 2px solid #0f0;
      }
      #debug-overlay .log { margin: 2px 0; }
      #debug-overlay .error { color: #f00; }
      #debug-overlay .success { color: #0f0; }
      #debug-overlay .info { color: #fa0; }
    </style>
    <script>
      // Debug logger
      window.debugLog = function(msg, type = 'info') {
        const overlay = document.getElementById('debug-overlay') || createDebugOverlay();
        const div = document.createElement('div');
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toISOString().slice(11, 23)}] ${msg}`;
        overlay.appendChild(div);
        overlay.scrollTop = overlay.scrollHeight;
        console.log(`[DEBUG] ${msg}`);
      };
      
      function createDebugOverlay() {
        const overlay = document.createElement('div');
        overlay.id = 'debug-overlay';
        document.body.appendChild(overlay);
        return overlay;
      }

      // Pre-configure Gateway URL before app loads
      (function() {
        debugLog('üöÄ Initializing Mission Control...', 'info');
        
        const settings = {
          gatewayUrl: "ws://100.71.186.68:18789",
          token: "",
          sessionKey: "main",
          lastActiveSessionKey: "main",
          theme: "system",
          chatFocusMode: false,
          chatShowThinking: true,
          splitRatio: 0.6,
          navCollapsed: false,
          navGroupsCollapsed: {}
        };
        
        localStorage.setItem("openclaw.control.settings.v1", JSON.stringify(settings));
        debugLog(`‚úì Settings configured: ${settings.gatewayUrl}`, 'success');
        
        // Monitor app initialization
        window.addEventListener('error', (e) => {
          debugLog(`‚ùå Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
          debugLog(`‚ùå Unhandled rejection: ${e.reason}`, 'error');
        });
        
        // Monitor custom element registration
        const origDefine = customElements.define.bind(customElements);
        customElements.define = function(name, constructor, options) {
          debugLog(`‚úì Custom element registered: <${name}>`, 'success');
          return origDefine(name, constructor, options);
        };
        
        debugLog('‚è≥ Waiting for main.ts module load...', 'info');
      })();
    </script>
  </head>
  <body>
    <openclaw-app></openclaw-app>
    <script type="module" src="/src/main.ts"></script>
    <script>
      // Monitor app element appearance
      setTimeout(() => {
        const app = document.querySelector('openclaw-app');
        if (app) {
          if (app.shadowRoot) {
            debugLog('‚úì App element has shadow root', 'success');
          } else {
            debugLog('‚ö† App element exists but no shadow root yet', 'info');
          }
        } else {
          debugLog('‚ùå openclaw-app element not found after 2s', 'error');
        }
      }, 2000);
    </script>
  </body>
</html>
